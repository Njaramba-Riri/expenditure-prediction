{% extends 'base.html' %}

{% block title %}LetsGo | Dashboard {% endblock %}

{% block content %}
<head>
    {% include 'include/sidebar.html' %}  
</head>
<section>
    <div class="main-dash" id="main-dash">
        <section class="topbar" id="topbar">
            <div class="toggle">
                <ion-icon name="menu-outline"></ion-icon>
            </div>
            <div class="find">
                <label>
                    <input type="text" placeholder="Search Here.">
                    <ion-icon name="search-outline"></ion-icon>
                </label>
            </div>
            <div class="user" id="user">
                <a href="{{ url_for('.profile', username=current_user.username) }}">
                    <span>{{ current_user.username }}</span>
                    {% if current_user.gravatar %}
                        <img src="{{ current_user.gravatar(100)}}" alt="">
                    {% else %}
                        <img src="../static/images/admin.png" alt=""> 
                    {% endif %}               
                </a>
            </div>
        </section>
        <div class="dash-cont" id="dash-content">
            <section class="cardBox">
                <div class="card" data-tilt>
                    <div>
                        <div class="figures">{{ all | count }}</div>
                        <div class="title">Total Users</div>
                    </div>
                    <div class="icontitle">
                        <ion-icon name="people-outline"></ion-icon>
                    </div>
                </div>
                <div class="card" data-tilt>
                    <div>
                        <div class="figures">{{ new | length }}</div>
                        <div class="title">New Users</div>
                    </div>
                    <div class="icontitle">
                        <ion-icon name="person-add-outline"></ion-icon>
                    </div>
                </div>
                <div class="card" data-tilt>
                    <div>
                        <div class="figures">{{ feedback | length }}</div>
                        <div class="title">Feedback</div>
                    </div>
                    <div class="icontitle">
                        <ion-icon name="chatbubble-outline"></ion-icon>
                    </div>
                </div>
                <div class="card" data-tilt>
                    <div>
                        <div class="figures">{{ all_f | length }}</div>
                        <div class="title">Model Calls</div>
                    </div>
                    <div class="icontitle">
                        <ion-icon name="cog-outline"></ion-icon>
                    </div>
                </div>
                <div class="card" data-tilt>
                    <div>
                        <div class="figures">5%</div>
                        <div class="title">Data Drift</div>
                    </div>
                    <div class="icontitle">
                        <ion-icon name="hourglass-outline"></ion-icon>
                    </div>
                </div>
                <div class="card" data-tilt>
                    <div>
                        <div class="figures">{{ score | round(1) * 100}} </div>
                        <div class="title">Model Accuracy</div>
                    </div>
                    <div class="icontitle">
                        <ion-icon name="fitness-outline"></ion-icon>
                    </div>
                </div>
            </section>
            <section class="chartSec">
                <div class="sect1">
                    <div class="chart">
                        <canvas id="polar"></canvas>
                    </div>
                    <div class="chart">
                        <canvas id="donut" height="300"></canvas>
                    </div>                    
                </div>                
                <div class="sect2">
                    <div class="chart">
                        <canvas id="line" height="400"></canvas>
                    </div>
                    <!-- <div class="chart">
                        <div id="sunburst" style="overflow: hidden;"></div>
                    </div> -->
                    <div class="chart">
                        <canvas id="bar" height="400"></canvas>
                    </div>                     
                </div>
            </section> 
            <section class="influence"  data-url="{{ imps | tojson | safe }}">
                <div class="chart">
                    <canvas id="imps" width=570 height=400></canvas>
                </div>
            </section>
            <section class="mezas">
                <div class="feat-tab">
                    <div class="tab-header">
                        <h2>Submited Features.</h2>
                        <a href="{{ url_for('.features') }}" class="btn">View All</a>                    
                    </div>
                    <div class="table_body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Country</th>
                                    <th>Region</th>
                                    <th>Age</th>
                                    <th>Companion</th>
                                    <th>Purpose</th>
                                    <th>Activity</th>
                                    <th>Info</th>
                                    <th>Arrangement</th>
                                    <th>Category</th>
                                    <th>Probability</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for feature in features %}
                                <tr>
                                    <td>{{ feature.country }}</td>
                                    <td>{{ feature.region }}</td>
                                    <td>{{ feature.age_group }}</td>
                                    <td>{{ feature.travel_with }}</td>
                                    <td>{{ feature.purpose }}</td>
                                    <td>{{ feature.main_activity }}</td>
                                    <td>{{ feature.info_source }}</td>
                                    <td>{{ feature.tour_arrangement }}</td>
                                    <td>{{ feature.predicted_category }}</td>
                                    <td>{{ feature.probability }} %</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>                                    
                    </div>
                </div>                                                        
            </section>
            <section class="mezas2">
                <div class="feed-tab">
                    <div class="tab-header">
                        <h2>User Feedback.</h2>
                        <a href="{{ url_for('.feed') }}" class="btn">View All</a>
                    </div>
                    <div class="table_body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Feedback</th>
                                    <th>Sentiment</th>
                                    <th>Probability</th>
                                    <th>By</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for feed in feedback %}    
                                <tr>
                                    <td>{{ feed.feed | truncate(100, true, '......') }}</td>
                                    {% if feed.sentiment == 'Positive' %}
                                    <td class="data">
                                        <span class="Positive">{{ feed.sentiment }}</span>
                                    </td>
                                    {% elif feed.sentiment == 'Negative' %}
                                    <td class="data">
                                        <span class="Negative">{{ feed.sentiment }}</span>
                                    </td>
                                    {% endif %}
                                    <td>{{ feed.probability }} %</td>
                                    {% if feed.user_id %}
                                        {% for user in users %}
                                            {% if feed.user_id == user.id %}
                                                <td class="data">   
                                                    <a href="{{ url_for('.user_profile', username=user.username) }}">
                                                        {{ user.username  }}
                                                    </a>                                     
                                                </td>
                                            {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        <td style="color: brown;"><i class="fa fa-warning"></i> None</td>
                                    {% endif %}

                                    <td>{{ moment(feed.date).fromNow() }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>                                    
                    </div>
                </div> 
                <div class="user-tab">
                    <div class="tab-header">
                        <h2>System Users</h2>
                        <a href="{{ url_for('.users') }}" class="btn">View all</a>
                    </div>    
                    <div class="table_body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>Email</th>
                                    <th>Username</th>
                                    <th>Joined</th>
                                    <th>Confirmed</th>
                                    <th>Interactions</th>                                   
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in users %}
                                <tr>
                                    <td>{{ user.id }}</td>
                                    <td>{{ user.email }}</td>
                                    <td>{{ user.username }}</td>
                                    <td>{{ user.date_created }}</td>
                                    {% if user.confirmed == 1 %}
                                    <td><span class="very">{{ user.confirmed }} </span></td>
                                    {% else %}
                                    <td ><span class="not">{{ user.confirmed }}</span></td>
                                    {% endif %}
                                    <td>{{ user.role_id }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>  
                </div> 
            </section>                       
        </div>
    </div>
</section>
{% endblock %}
{% block js %}
    {{ super() }}
    {{ moment.include_moment() }}
    <script>
        var imps = {{ imps | tojson | safe }};

        drawImportance(imps);
    </script>
{% endblock %}
